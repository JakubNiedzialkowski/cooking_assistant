<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title> {{ loadedRecipe?.title }} </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="!isEditPanelVisible">
  <ion-img *ngIf="loadedRecipe?.image === null" style="max-height:200px" src="//tutorialsplane.com/wp-content/uploads/2017/01/tomato-1862857__340.jpg"></ion-img>
  <ion-item style="max-height:200px">
      <ion-img *ngIf="loadedRecipe?.image != null" style="max-height:200px" [src]="loadedRecipe?.image.resourcePath"></ion-img>
  </ion-item>

  <ion-item>
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-button (click)="editRecipe()" style="width:100%" color="primary">Edytuj przepis</ion-button>
        </ion-col>
        <ion-col>
          <ion-button (click)="deleteRecipe()" style="width:100%" color="danger">Usuń przepis</ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-item>

  <ion-item (click)="toggleSteps()" color="primary">
    <ion-label>
      Przygotowanie przepisu
      <ion-icon style="float:right" name="arrow-round-down" [hidden]="isStepsListVisible"></ion-icon>
      <ion-icon style="float:right" name="arrow-round-up" [hidden]="!isStepsListVisible"></ion-icon>
    </ion-label>
  </ion-item>
  <ion-list [hidden]="!isStepsListVisible">
    <ion-item *ngFor="let step of loadedRecipe?.steps">
      {{ step }}
    </ion-item>
  </ion-list>

  <ion-item (click)="toggleIngredients()" color="primary">
    <ion-label>
      Składniki
      <ion-icon style="float:right" name="arrow-round-down" [hidden]="isIngredientListVisible"></ion-icon>
      <ion-icon style="float:right" name="arrow-round-up" [hidden]="!isIngredientListVisible"></ion-icon>
    </ion-label>
  </ion-item>
  <ion-list [hidden]="!isIngredientListVisible">
    <ion-item *ngFor="let ingredient of loadedRecipe?.ingredients; let i=index">
      {{ ingredient }} {{ loadedRecipe.ingredientAmounts[i] }}
    </ion-item>
  </ion-list>

</ion-content>

<ion-footer *ngIf="!isEditPanelVisible">
  <ion-button (click)="startCooking()" size="large" expand="block" shape="round" color="primary">
    Rozpocznij gotowanie
  </ion-button>
</ion-footer>

<ion-content *ngIf="isEditPanelVisible">
  <!-- Edycja przepisu -->
  <ion-item *ngIf="loadedRecipe.image != null">
    <ion-img style="max-height:200px" [src]="loadedRecipe?.image.resourcePath"></ion-img>
  </ion-item>
  <ion-button expand="block" color="primary" (click)="selectImage()">
    <ion-icon slot="end" name="camera"></ion-icon>
    <ion-text>Dodaj obraz</ion-text>
  </ion-button>

  <ion-item>
    <ion-label position="fixed">Nazwa przepisu</ion-label>
    <ion-input [(ngModel)]="loadedRecipe.title"></ion-input>
  </ion-item>

  <ion-label position="fixed">Kroki</ion-label>
  <ion-item>
    <ion-grid>
      <ion-row *ngFor="let s of loadedRecipe.steps; let i=index; trackBy: trackById">
        <ion-col>
          <ion-input [(ngModel)]="loadedRecipe.steps[i]"></ion-input>
        </ion-col>
        <ion-col>
          <ion-datetime displayFormat="HH:mm:ss" pickerFormat="HH : mm : ss" [(ngModel)]="formattedTimes[i]">
          </ion-datetime>
        </ion-col>
        <ion-col size="2">
          <ion-button color="danger" (click)="deleteStep(i)">
            <ion-icon name="trash"></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-button (click)="addNewStep()" style="width:100%" color="primary">
          <ion-text>Nowy krok</ion-text>
        </ion-button>
      </ion-row>
    </ion-grid>
  </ion-item>

  <ion-label position="fixed">Składniki</ion-label>
  <ion-item>
    <ion-grid>
      <ion-row *ngFor="let s of loadedRecipe.ingredients; let i=index; trackBy: trackById">
        <ion-col>
          <ion-input [(ngModel)]="loadedRecipe.ingredients[i]"></ion-input>
        </ion-col>
        <ion-col>
          <ion-input [(ngModel)]="loadedRecipe.ingredientAmounts[i]"></ion-input>
        </ion-col>
        <ion-col size="2">
          <ion-button color="danger" (click)="deleteIngredient(i)">
            <ion-icon name="trash"></ion-icon>
          </ion-button>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-button (click)="addNewIngredient()" style="width:100%" color="primary">
          <ion-text>Nowy składnik</ion-text>
        </ion-button>
      </ion-row>
    </ion-grid>
  </ion-item>

  <ion-item>
    <ion-grid>
      <ion-row>
        <ion-col>
          <ion-button (click)="cancelEdit()" style="width:100%" color="danger">Wróć</ion-button>
        </ion-col>
        <ion-col>
          <ion-button (click)="applyChanges()" style="width:100%" color="success">Zapisz</ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-item>
</ion-content>